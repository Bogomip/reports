<div class="component-intro">    
    <h4 class="component-intro__description">
        Edit the main template for the sentence structures available.
    </h4>
</div>

<div class="admin-sentences__controls">
    <div class="admin-sentences__controls--subdivision">

        <div class="admin-sentences__control-bar">
            <div class="admin-sentences__control-bar--control admin-sentences__control-bar--control-autosave">AutoSave</div>
            <div class="admin-sentences__control-bar--control admin-sentences__control-bar--control-dataview">Full Data View</div>
            <div class="admin-sentences__control-bar--control admin-sentences__control-bar--control-savelocal">Save Data Locally</div>
            <div class="admin-sentences__control-bar--control admin-sentences__control-bar--control-commit">Commit to Database</div>
        </div>
<!-- 
        <div class="admin-sentences__save-control">
            <input type="checkbox" class="admin-sentences__control--checkbox" name="autoSave" id="autoSave">
            <label for="autoSave" class="admin-sentences__control--label" (click)="autosaveToggle()">Autosave Changes ({{ autosave ? "Enabled" : "Disabled" }})</label>
        </div>
        <div class="admin-sentences__save-control">
            <input type="checkbox" class="admin-sentences__control--checkbox" name="dataView" id="dataView" [checked]="singleStreamDataView">
            <label for="dataView" class="admin-sentences__control--label" (click)="setFullDataView()">Data View ({{ singleStreamDataView ? "Single Stream" : "Full View" }})</label>
        </div> -->
    </div>
    <!-- <div>
        <button class="admin-sentences__save-button" *ngIf="!autosave && unsavedChanges" (click)="saveChanges()">Save changes</button>
        <button class="admin-sentences__commit-button" *ngIf="!autosave && unsavedChanges" (click)="reUploadToFirebase()">Commit to DB</button>
    </div> -->
</div>

<div class="admin-sentences">
    
    <div class="loading" *ngIf="isLoading">
        <app-loading-spinner></app-loading-spinner>
    </div>

    <!-- set clickable if there is a route to take -->
    <div class="admin-sentences__level admin-sentences__level--base">
        <div class="admin-sentences__stem-phrase" (click)="resetRoute()">
            Base
        </div>
    </div>
    <div class="admin-sentences__level admin-sentences__level--{{o}}"  *ngFor="let sentenceStem of viewData; let o = index" >

        <div>
            <div class="admin-sentences__stem-phrase" *ngFor="let sentence of sentenceStem; let i = index">
                <div class="admin-sentences__stem-phrase--title" [class.admin-sentences__stem-phrase--route]="route[sentence.order+1] === sentence.index">
                    <div    class="admin-sentences__stem-phrase--name" 
                            (blur)="modifyName(sentence.order, sentence.index, $event)" 
                            (keyup.enter)="modifyName(sentence.order, sentence.index, $event)" 
                            contenteditable="true" 
                            data-placeholder="Unnamed...">
                        {{ sentence.name | slice:0:(50/sentenceStem.length) }}
                    </div>
                    <div class="admin-sentences__stem-phrase--controls">
                        <div class="admin-sentences__stem-phrase--control admin-sentences__stem-phrase--control-delete" (click)="deleteRoute(sentence.order, sentence.index)">&times;</div>
                        <div class="admin-sentences__stem-phrase--control admin-sentences__stem-phrase--control-starter" [class.admin-sentences__stem-phrase--control-starter--selected]="sentence.starter" (click)="modifyStartpointData(sentence.order, sentence.index, sentence.starter)">St</div>
                        <div class="admin-sentences__stem-phrase--control admin-sentences__stem-phrase--control-next" (click)="setView(sentence.order, sentence.index)">&#9755;</div>
                    </div>
                </div>
                <div class="admin-sentences__stem-phrase--sentence" [class.admin-sentences__stem-phrase--editable]="sentence.sentence" *ngFor="let text of sentence.sentence; let s = index">
                    <div style="font-weight: bold">Option {{ s+1 }}:</div> 
                    <div    class="admin-sentences__stem-phrase--sentence--input" 
                            (keyup.enter)="modifySentenceData(sentence.order, sentence.index, s, $event)" 
                            (blur)="modifySentenceData(sentence.order, sentence.index, s, $event)" 
                            data-placeholder="No sentences defined..." 
                            contenteditable="true">
                            {{ text ? text : "" }}
                    </div>
                </div>

                <div class="admin-sentences__stem-phrase--tests" *ngIf="(sentence.tests && sentence.tests.length > 0) || addTest.order === sentence.order && addTest.index === sentence.index">
                    <div class="admin-sentences__stem-phrase--test" *ngFor="let test of sentence.tests; let t = index">
                        <div class="admin-sentences__stem-phrase--test--name">{{ test.name }}</div>
                        <div class="admin-sentences__stem-phrase--test--buttons">
                            <div class="admin-sentences__stem-phrase--test--delete" (click)="removeTest(sentence.order, sentence.index, t)">&times;</div>
                        </div>
                    </div>
                    <div class="admin-sentences__stem-phrase--test" *ngIf="addTest.order === sentence.order && addTest.index === sentence.index">
                        <select name="newTest" id="newTest">
                            <option value="{{ test.name }}" *ngFor="let test of filterTests(sentence.tests, testsService.testsList); let u = index">{{ test.name }}</option>
                        </select>
                        <div class="admin-sentences__stem-phrase--test--buttons">
                            <div class="admin-sentences__stem-phrase--test--accept" (click)="addNewTest(sentence.order, sentence.index)">&#10004;</div>
                        </div>
                    </div>
                </div>
                <div class="admin-sentences__buttons-bottom">
                    <div class="admin-sentences__buttons-bottom--add-sentence" (click)="addNewSentence(sentence.order, sentence.index)">Add Sentence</div>
                    <div class="admin-sentences__buttons-bottom--add-test" (click)="addNewTestSelectionBox(sentence.order, sentence.index)">Add Test</div>
                </div>
            </div>
        </div>
        <div class="admin-sentences__stem-phrase--add" (click)="addNewSubLevel(o)">Add sublevel...</div>

    </div>

</div>

<div class="sentences">
    <div class="sentences__title">
        Below are the potential sentences from the sentence structure:
        <div class="sentences__title--structure">
            <span *ngFor="let name of getRouteNames(); let i = index">{{ name }} <div class="span" *ngIf="i === getRouteNames().length"></div></span>
        </div>
    </div>
    <div class="sentences__row sentences__header">
        <div class="sentences__number">#</div>
        <div class="sentences__characters">Characters</div>
        <div class="sentences__sentence">Sentence</div>
    </div>
    <div class="sentences__row sentences__possibility" *ngFor="let possibility of possibilities; let i = index">
        <div class="sentences__number">{{ i + 1 }}</div>
        <div class="sentences__characters">{{ possibility.sentence.length }}</div>
        <div class="sentences__sentence">{{ possibility.sentence }}</div>
    </div>
</div>