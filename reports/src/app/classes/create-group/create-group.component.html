<div class="create-group">
    <div class="create-group__group-name">
        <div class="create-group__group-name--text">
            New group name
            <div class="reports__variable--tooltip tooltipped tooltip__generic" *ngIf="helpFlag">
                <div class="tooltip">This is the name you will use to import these students into the main reports. As a suggestion you should make it somewhat descriptive, so in the future you remember who they are (I.E AP Block 4 2021-2022).</div>
            </div>
        </div>
        <div class="create-group__group-name--input">
            <input type="text" name="groupNameText" id="groupNameText" [(ngModel)]="groupname">
        </div>
        <div class="create-group__group-name--text">
            Group Description
            <div class="reports__variable--tooltip tooltipped tooltip__generic" *ngIf="helpFlag">
                <div class="tooltip">This is an optional field, and can be useful if you have multiple templates for the same group, i.e. one set of reports for the high achieving students and one for the lower.</div>
            </div>
        </div>
        <div class="create-group__group-name--input">
            <input type="text" name="groupDescriptionText" id="groupDescriptionText" [(ngModel)]="groupDescription" placeholder="Optional Description">
        </div>
    </div>

    <div class="create-group__input"  *ngIf="!userDataGenerated || modifyData">

        <div class="create-group__text">

            <div class="create-group__text--textbox">
                <textarea name="groupInputBox" id="groupInputBox" class="create-group__text--textbox--input" [(ngModel)]="userInfo" placeholder="Paste your class data here to add to the group... For the best results make the top line your data titles, then each new line a new subject (student, employee etc) separating the data with commas... 'Alex,Bunting,Alex,alex@reportwriter.com,Other Data' would be a good example for one line using comma notation."></textarea>
            </div>
            <div class="create-group__text--submit">
                <div class="create-group__text--header-check">

                  <select class="input__select" name="groupCreationAlgorithm" id="groupCreationAlgorithm" (chnage)="setDataSeparation($event.target.value)">
                    <option [selected]="separation === '\\t'" value="\\t">Tab Seperated (Spreadsheets)</option>
                    <option [selected]="separation === '[,\\t]'" value="[,\\t]">Tab and Comma (Powerteacher Export)</option>
                    <option [selected]="separation === ','" value=",">Comma Seperated (Manual or CSV Input)</option>
                    <option [selected]="separation === ''" value="">Attempt Automatic Group Generation</option>
                  </select>

                  <input type="text" name="numberOfStudents" id="numberOfStudents" class="input__text" style="width: 15rem;" [(ngModel)]="numberOfStudents" placeholder="Number of students" title="Optional, but very helpful to successful auto generation!">

                  <input type="checkbox" name="groupInputHeaderBox" id="groupInputHeaderBox" [(ngModel)]="headerRow" checked>
                  <label for="groupInputHeaderBox">Top row is header text</label>
                </div>

                <button class="create-group__text--submit--button create-group__text--submit--enabled" (click)="generateUserData()">Create Group</button>
            </div>
        </div>
    </div>

    <div class="create-group__controls" *ngIf="userDataGenerated">
        <div class="create-group__control-buttons">
            <button class="create-group__text--submit--button create-group__text--submit--enabled" *ngIf="userData" (click)="modifyGroupData()">Modify Group Data</button>
            <button class="create-group__text--submit--button create-group__text--submit--enabled" *ngIf="userData && customService.allowGroupCreation()" (click)="createNewGroup()">Create New Group</button>
            <button class="create-group__text--submit--button" [class.create-group__text--submit--enabled]="!dataSubmitting && groupname" *ngIf="userDataGenerated && !groupId" (click)="createGroup()" [disabled]="dataSubmitting || !groupname">{{ !dataSubmitting ? "Submit to Database" : "Working" }}</button>
            <button class="create-group__text--submit--button" [class.create-group__text--submit--enabled]="!dataSubmitting && groupname && !dataUpdated" [class.create-group__text--submit--updated]="dataUpdated" *ngIf="userDataGenerated && groupId" (click)="updateGroup()" [disabled]="dataSubmitting || !groupname || !dataChanged">{{ !dataSubmitting ? "Update Group Data" : "Updating Data" }}</button>
        </div>

        <div class="create-group__success" *ngIf="groupId">
            Group '<span>{{ groupname }}</span>' created.
        </div>
    </div>

    <div class="create-group__data" *ngIf="userData">

        <table class="create-group__data--table">
            <thead>
                <tr class="create-group__data--row create-group__data--header">
                    <td class="create-group__data--cell" *ngFor="let key of keys; let i = index">
                        <div class="create-group__data--cell--header">
                            <div (keyup.enter)="columnValueChange(i, $event)" (blur)="columnValueChange(i, $event)" contenteditable="true">{{ key }}</div>
                            <div class="create-group__data--buttons create-group__data--buttons-remove tooltipped" (click)="deleteColumn(i)">&#10006; <div class="tooltip">Delete this column (cannot be reversed)</div></div>
                        </div>
                    </td>
                    <td class="create-group__data--cell">
                        <div class="create-group__data--buttons create-group__data--buttons-addcol tooltipped" (click)="addColumn()">&#10010; <div class="tooltip">Add a new column</div></div>
                    </td>
                </tr>
            </thead>
            <tbody>
                <tr class="create-group__data--row create-group__data--data" *ngFor="let row of userData; let i = index">
                    <td class="create-group__data--cell" *ngFor="let user of sortDataForDisplay(row.data) | keyvalue : returnZero; let ki = index">
                        <!-- {{ user.value }} -->
                        <input class="create-group__datainput" (blur)="userValueChange(row.id, user.key, $event.target.value)" (keyup.enter)="userValueChange(row.id, user.key, $event.target.value)" value="{{ user.value }}" tabindex="{{ (userData.length * ki) + i }}">
                    </td>
                    <!-- PUT TEXT BOXES IN -->

                    <td class="create-group__data--cell">
                        <div class="create-group__data--buttons create-group__data--buttons-remove tooltipped" (click)="removeUser(row.id)">&#10006; <div class="tooltip">Delete this user</div></div>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <div class="create-group__manual-button" *ngIf="!userData">
      Add users manually...
    </div>

</div>
