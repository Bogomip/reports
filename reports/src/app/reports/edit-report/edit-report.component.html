<div class="reports__options sticky">
    <div class="reports__settings">

        <div class="reports__settings--flex">
            <div class="reports__settings--setting">
                <div class="reports__settings--text">Reports Name</div>
                <div class="reports__settings--input">
                    <input type="text" name="reportsname" id="reportsname" [(ngModel)]="reportName" class="reports__input reports__input--text">
                </div>
            </div>
            <div class="reports__settings--setting">
                <div class="reports__settings--text">Class</div>
                <div class="reports__settings--input">
                    <select name="reportsclass" id="reportsclass" class="reports__input reports__input--select"  (change)="loadGroup($event.target.value)">
                        <option value="" disabled selected></option>
                        <option value="{{ grp.id }}" *ngFor="let grp of groups; let i = index">{{grp.name}}</option>
                    </select>
                </div>
            </div>
            <div class="reports__settings--setting">
                <div class="reports__settings--text">Template</div>
                <div class="reports__settings--input">
                    <select name="reportstemplate" id="reportstemplate" class="reports__input reports__input--select" (change)="loadTemplate($event.target.value)">
                        <option value="" disabled selected></option>
                        <option value="{{ temp.id }}" *ngFor="let temp of templates; let i = index">{{temp.name}}</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="reports__database-buttons">
            <div class="reports__button">Save</div>
            <div class="reports__button">Update</div>
            <div class="reports__button">Duplicate</div>

        </div>
    </div>
</div>

<div class="divider-line divider-line__thin" *ngIf="report !== undefined"></div>

<!-- global variables, things which are the same for each student... -->
<div class="reports__global-variables" *ngIf="report !== undefined">
    <div class="reports__global-variables--text">
        Global Variables 
    </div>

    <div class="reports__global-variable" *ngFor="let variable of report.globals; let i = index">
        <div class="reports__global-variable--text">
            {{ variable.identifier }}
        </div>

        <div class="reports__global-variable--input">
            <input type="text" class="reports__input reports__input--text" *ngIf="variable.options.length === 0"  (blur)="assignGlobalValue(variable.identifier, $event.target.value)" (keyup.enter)="assignGlobalValue(variable.identifier, $event.target.value)">
            <select class="reports__input reports__input--select" (change)="assignGlobalValue(variable.identifier, $event.target.value)" *ngIf="variable.options.length > 0 && variable.options[variable.options.length-1] !== ''">
                <option value="" selected disabled></option>
                <option value="newOption">* Add new option *</option>
                <option value="{{ option }}" *ngFor="let option of variable.options; let index = index">{{ option }}</option>
            </select>
            <input type="text" class="reports__input reports__input--text" *ngIf="variable.options[variable.options.length-1] === ''"  (blur)="addGlobalOption(variable.identifier, $event.target.value)" (keyup.enter)="addGlobalOption(variable.identifier, $event.target.value)">
        </div>
    </div>
</div>

<!-- variables, things that needf a value for each student -->
<div class="reports__variables" *ngIf="report !== undefined">
    <div class="reports__variables--text">
        Variables
    </div>

    <div class="reports__variable draggable" *ngFor="let variable of report.variables; let i = index">
        {{ variable.identifier }}

        <select class="reports__input reports__input--select" (change)="assignVariableColumn($event.target.value, variable.identifier)" [disabled]="checkVariableAssignment(variable.identifier)">
            <option value="" selected disabled></option>
            <option value="{{ variable.identifier }}">* Add column *</option>
            <option value="{{ option }}" *ngFor="let option of report.keys; let index = index">{{ option }}</option>
        </select>
    </div>
</div>

<div class="divider-line divider-line__thin u__margin-top--medium" *ngIf="report !== undefined"></div>

<div class="reports__data">
    <!-- Data table -->
    <table class="reports__data--table" *ngIf="loadedGroup !== undefined">
        <thead>
            <tr class="reports__data--row reports__data--header">
                <td class="reports__data--cell" *ngFor="let key of report.keys; let i = index">
                    <div class="reports__data--cell-header draggable__enter">
                        {{ key }}
                        <!-- what does this column relate to in the rpeort -->
                        <div class="reports__key-variable-link--flexbox">
                            <div class="reports__key-variable-link" *ngFor="let variable of report.variables">
                                <div class="reports__key-variable-link--link" *ngIf="variable.key === key" (click)="removeVariableAssignment(variable.identifier)">
                                    {{ variable.identifier }}
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </thead>
        <tbody>
            <!-- user data -->
            <tr class="reports__data--row reports__data--data" *ngFor="let individual of report.reports; let reportId = index">
                <td class="reports__data--cell" *ngFor="let key of report.keys; let i = index" contenteditable="true" (keyup.enter)="valueChange(reportId, key, $event)" (blur)="valueChange(reportId, key, $event)">{{ individual.user[key] }}</td>
                <!-- <td class="reports__data--cell" *ngFor="let key of report.keys; let i = index">
                    <input type="text" class="input__test" (keyup.enter)="valueChange(reportId, key, $event)" (blur)="valueChange(reportId, key, $event)" value="{{individual.user[key]}}">
                </td> -->
            </tr>
        </tbody>
    </table>
</div>